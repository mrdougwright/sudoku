defmodule SudokuTest do
  use ExUnit.Case
  doctest Sudoku

  setup do
    grids()
  end

  describe "valid_grid?/1" do
    test "returns true if sudoku grid valid!", %{valid: grids} do
      Enum.each(grids, fn grid ->
        assert Sudoku.valid_grid?(grid) == true
      end)
    end

    test "returns false if sudoku grid invalid", %{invalid: bad_grids} do
      Enum.each(bad_grids, fn grid ->
        assert Sudoku.valid_grid?(grid) == false
      end)
    end
  end

  describe "valid_rows?/1" do
    test "returns true for valid rows", %{valid: grids} do
      Enum.each(grids, fn grid ->
        assert Sudoku.valid_rows?(grid) == true
      end)
    end

    test "returns false for invalid row", %{invalid: bad_grids} do
      full_grid = bad_grids |> List.last()
      assert Sudoku.valid_rows?(full_grid) == false
    end
  end

  describe "valid_columns?/1" do
    test "returns true for valid columns", %{valid: grids} do
      Enum.each(grids, fn grid ->
        assert Sudoku.valid_columns?(grid) == true
      end)
    end

    test "returns false for invalid columns", %{invalid: bad_grids} do
      full_grid = bad_grids |> List.last()
      assert Sudoku.valid_columns?(full_grid) == false
    end
  end

  describe "valid_sub_grids?/1" do
    test "returns true if all 9 quadrants are valid", %{valid: grids} do
      Enum.each(grids, fn grid ->
        assert Sudoku.valid_sub_grids?(grid) == true
      end)
    end

    test "returns false if any of 9 quadrants invalid", %{invalid: bad_grids} do
      full_grid = bad_grids |> List.last()
      assert Sudoku.valid_sub_grids?(full_grid) == false
    end
  end

  def grids do
    valid = [
      [
        ['.', '.', '.', '1', '4', '.', '.', '2', '.'],
        ['.', '.', '6', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '1', '.', '.', '.', '.', '.', '.'],
        ['.', '6', '7', '.', '.', '.', '.', '.', '9'],
        ['.', '.', '.', '.', '.', '.', '8', '1', '.'],
        ['.', '3', '.', '.', '.', '.', '.', '.', '6'],
        ['.', '.', '.', '.', '.', '7', '.', '.', '.'],
        ['.', '.', '.', '5', '.', '.', '.', '7', '.']
      ],
      # Valid
      [
        ['1', '2', '3', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '7', '.', '.', '.', '.'],
        ['4', '5', '6', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['.', '.', '.', '.', '.', '.', '.', '.', '.']
      ],
      # Valid
      [
        ['1', '2', '3', '4', '5', '6', '7', '8', '9'],
        ['4', '5', '6', '7', '8', '9', '1', '2', '3'],
        ['7', '8', '9', '1', '2', '3', '4', '5', '6'],
        ['2', '3', '4', '5', '6', '7', '8', '9', '1'],
        ['5', '6', '7', '8', '9', '1', '2', '3', '4'],
        ['8', '9', '1', '2', '3', '4', '5', '6', '7'],
        ['3', '4', '5', '6', '7', '8', '9', '1', '2'],
        ['6', '7', '8', '9', '1', '2', '3', '4', '5'],
        ['9', '1', '2', '3', '4', '5', '6', '7', '8']
      ]
    ]

    invalid = [
      # Invalid
      [
        ['1', '2', '3', '4', '5', '6', '6', '8', '9'],
        ['4', '5', '6', '.', '.', '.', '.', '.', '.'],
        ['7', '8', '9', '.', '.', '.', '.', '.', '.'],
        ['2', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['5', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['8', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['3', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['6', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['9', '.', '.', '.', '.', '.', '.', '.', '.']
      ],
      # Invalid
      [
        ['1', '2', '3', '4', '5', '6', '7', '8', '9'],
        ['4', '5', '6', '.', '.', '.', '.', '.', '.'],
        ['7', '8', '9', '.', '.', '.', '.', '.', '.'],
        ['2', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['5', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['3', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['3', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['6', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['9', '.', '.', '.', '.', '.', '.', '.', '.']
      ],
      # Invalid
      [
        ['1', '2', '3', '4', '5', '6', '7', '8', '9'],
        ['4', '5', '8', '.', '.', '.', '.', '.', '.'],
        ['7', '8', '9', '.', '.', '.', '.', '.', '.'],
        ['2', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['5', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['8', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['3', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['6', '.', '.', '.', '.', '.', '.', '.', '.'],
        ['9', '.', '.', '.', '.', '.', '.', '.', '.']
      ],
      # Invalid
      [
        ['1', '2', '8', '4', '5', '6', '7', '8', '9'],
        ['4', '7', '6', '7', '8', '9', '1', '2', '3'],
        ['7', '8', '9', '1', '2', '3', '4', '5', '6'],
        ['2', '3', '4', '5', '6', '7', '8', '9', '1'],
        ['5', '6', '7', '8', '9', '1', '2', '3', '4'],
        ['8', '9', '1', '2', '3', '4', '5', '6', '7'],
        ['3', '4', '5', '6', '7', '8', '9', '1', '2'],
        ['6', '7', '8', '9', '1', '2', '3', '4', '5'],
        ['9', '1', '2', '3', '4', '5', '6', '7', '8']
      ]
    ]

    %{valid: valid, invalid: invalid}
  end
end
